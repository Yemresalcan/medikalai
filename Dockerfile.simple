FROM python:3.9

WORKDIR /app

# Gerekli dosyaları kopyala
COPY . .

# Bağımlılıkları doğrudan yükle - pip hatası olasılığını azaltmak için
RUN pip install --no-cache-dir --upgrade pip && \
    pip install --no-cache-dir flask requests PyPDF2 openai bcrypt Flask-WTF flask-jwt-extended gunicorn stripe

# Volume dizini
RUN mkdir -p /data
ENV DB_PATH=/data/kan_tahlil_app.db

# Port ve host
ENV PORT=8080
ENV HOST=0.0.0.0

EXPOSE 8080

# Tek adımda çalıştır
CMD ["sh", "-c", "python -c 'from app import init_db; init_db()' && gunicorn app:app --bind 0.0.0.0:8080 --timeout 120"] 