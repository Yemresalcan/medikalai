{% extends "layout.html" %}

{% block title %}Tahlil Sonu√ßlarƒ±m - MEDIKAL-AI{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.css">
<style>
    /* Premium Result Dashboard Styles */
    .hero-health-section {
        background: linear-gradient(135deg, #0f1419 0%, #1a2332 30%, #33baf7 60%, #1e3a8a 90%, #0f1419 100%);
        color: white;
        padding: 3rem 0;
        position: relative;
        overflow: hidden;
    }
    
    .hero-health-section::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(circle at 40% 40%, rgba(51, 186, 247, 0.2) 0%, transparent 50%);
    }
    
    .hero-content {
        position: relative;
        z-index: 2;
    }
    
    /* Health Score Circle */
    .health-score-circle {
        width: 150px;
        height: 150px;
        position: relative;
        margin: 0 auto 2rem;
    }
    
    .health-score-svg {
        transform: rotate(-90deg);
        width: 100%;
        height: 100%;
    }
    
    .health-score-bg {
        fill: none;
        stroke: rgba(255, 255, 255, 0.2);
        stroke-width: 8;
    }
    
    .health-score-progress {
        fill: none;
        stroke: #ffffff;
        stroke-width: 8;
        stroke-linecap: round;
        stroke-dasharray: 440;
        stroke-dashoffset: 440;
        transition: stroke-dashoffset 2s ease;
    }
    
    .health-score-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
    }
    
    .health-score-number {
        font-size: 2.5rem;
        font-weight: 800;
        line-height: 1;
        display: block;
    }
    
    .health-score-label {
        font-size: 0.9rem;
        opacity: 0.9;
        margin-top: 0.5rem;
    }
    
    /* System Health Cards */
    .system-health-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 16px;
        padding: 1.5rem;
        height: 100%;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }
    
    .system-health-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1);
    }
    
    [data-bs-theme="dark"] .system-health-card {
        background: rgba(43, 48, 53, 0.95);
        border-color: rgba(255, 255, 255, 0.1);
    }
    
    .system-health-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        border-radius: 16px 16px 0 0;
    }
    
    .system-health-card.excellent::before { background: linear-gradient(90deg, #22c55e, #16a34a); }
    .system-health-card.good::before { background: linear-gradient(90deg, #3b82f6, #2563eb); }
    .system-health-card.fair::before { background: linear-gradient(90deg, #f59e0b, #d97706); }
    .system-health-card.poor::before { background: linear-gradient(90deg, #ef4444, #dc2626); }
    
    .system-icon {
        width: 50px;
        height: 50px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: white;
        margin-bottom: 1rem;
        transition: all 0.3s ease;
    }
    
    .system-health-card:hover .system-icon {
        transform: scale(1.1) rotate(5deg);
    }
    
    .system-icon.excellent { background: linear-gradient(135deg, #22c55e, #16a34a); }
    .system-icon.good { background: linear-gradient(135deg, #3b82f6, #2563eb); }
    .system-icon.fair { background: linear-gradient(135deg, #f59e0b, #d97706); }
    .system-icon.poor { background: linear-gradient(135deg, #ef4444, #dc2626); }
    
    .system-score {
        font-size: 2rem;
        font-weight: 800;
        line-height: 1;
        margin-bottom: 0.5rem;
    }
    
    .system-score.excellent { color: #22c55e; }
    .system-score.good { color: #3b82f6; }
    .system-score.fair { color: #f59e0b; }
    .system-score.poor { color: #ef4444; }
    
    .system-status {
        font-size: 0.9rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .system-status.excellent { color: #22c55e; }
    .system-status.good { color: #3b82f6; }
    .system-status.fair { color: #f59e0b; }
    .system-status.poor { color: #ef4444; }
    
    /* Parameter Cards */
    .parameter-card {
        background: white;
        border-radius: 12px;
        padding: 1.25rem;
        border: 1px solid rgba(51, 186, 247, 0.1);
        transition: all 0.3s ease;
        height: 100%;
    }
    
    .parameter-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(51, 186, 247, 0.15);
        border-color: rgba(51, 186, 247, 0.3);
    }
    
    [data-bs-theme="dark"] .parameter-card {
        background: rgba(43, 48, 53, 0.8);
        border-color: rgba(255, 255, 255, 0.1);
    }
    
    .parameter-status {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 0.5rem;
        flex-shrink: 0;
    }
    
    .parameter-status.normal { background: #22c55e; }
    .parameter-status.high { background: #ef4444; }
    .parameter-status.low { background: #f59e0b; }
    
    .parameter-value {
        font-size: 1.25rem;
        font-weight: 700;
        margin-bottom: 0.25rem;
    }
    
    .parameter-range {
        font-size: 0.8rem;
        color: #6b7280;
        margin-bottom: 0.75rem;
    }
    
    .parameter-gauge {
        height: 6px;
        background: #e5e7eb;
        border-radius: 3px;
        overflow: hidden;
        margin-bottom: 0.75rem;
    }
    
    [data-bs-theme="dark"] .parameter-gauge {
        background: #374151;
    }
    
    .parameter-gauge-fill {
        height: 100%;
        border-radius: 3px;
        transition: width 1.5s ease;
    }
    
    .parameter-gauge-fill.normal { background: linear-gradient(90deg, #22c55e, #16a34a); }
    .parameter-gauge-fill.high { background: linear-gradient(90deg, #ef4444, #dc2626); }
    .parameter-gauge-fill.low { background: linear-gradient(90deg, #f59e0b, #d97706); }
    
    /* Disease Analysis Cards */
    .disease-card {
        background: white;
        border-radius: 16px;
        padding: 1.5rem;
        border: 1px solid rgba(51, 186, 247, 0.1);
        transition: all 0.3s ease;
        height: 100%;
        position: relative;
        overflow: hidden;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }
    
    .disease-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
    }
    
    [data-bs-theme="dark"] .disease-card {
        background: rgba(43, 48, 53, 0.8);
        border-color: rgba(255, 255, 255, 0.1);
    }
    
    .disease-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 4px;
        height: 100%;
        border-radius: 16px 0 0 16px;
    }
    
    .disease-card.high-risk::before { background: linear-gradient(180deg, #ef4444, #dc2626); }
    .disease-card.medium-risk::before { background: linear-gradient(180deg, #f59e0b, #d97706); }
    .disease-card.low-risk::before { background: linear-gradient(180deg, #3b82f6, #2563eb); }
    .disease-card.no-risk::before { background: linear-gradient(180deg, #22c55e, #16a34a); }
    
    .disease-probability {
        font-size: 2rem;
        font-weight: 800;
        line-height: 1;
        margin-bottom: 0.5rem;
    }
    
    .disease-probability.high-risk { color: #ef4444; }
    .disease-probability.medium-risk { color: #f59e0b; }
    .disease-probability.low-risk { color: #3b82f6; }
    .disease-probability.no-risk { color: #22c55e; }
    
    /* Disease Header Icons */
    .disease-icon {
        width: 50px;
        height: 50px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: white;
        margin-bottom: 1rem;
        margin-right: 1rem;
        flex-shrink: 0;
    }
    
    .disease-icon.high-risk { background: linear-gradient(135deg, #ef4444, #dc2626); }
    .disease-icon.medium-risk { background: linear-gradient(135deg, #f59e0b, #d97706); }
    .disease-icon.low-risk { background: linear-gradient(135deg, #3b82f6, #2563eb); }
    .disease-icon.no-risk { background: linear-gradient(135deg, #22c55e, #16a34a); }
    .disease-icon.ai-prediction { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
    
    /* AI Prediction Styles */
    .disease-card.ai-prediction {
        border-color: rgba(139, 92, 246, 0.3);
        background: linear-gradient(145deg, rgba(139, 92, 246, 0.05), rgba(255, 255, 255, 0.95));
    }
    
    .disease-card.ai-prediction::before {
        background: linear-gradient(180deg, #8b5cf6, #7c3aed);
    }
    
    .ai-badge {
        background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .ai-recommendation {
        background: rgba(139, 92, 246, 0.1);
        border-radius: 8px;
        padding: 1rem;
        margin-top: 1rem;
    }
    
    .ai-recommendation h6 {
        color: #7c3aed;
        margin-bottom: 0.5rem;
    }
    
    /* Disease Parameters Tags */
    .disease-params {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin: 1rem 0;
    }
    
    .disease-param-tag {
        background: rgba(51, 186, 247, 0.1);
        color: #33baf7;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        border: 1px solid rgba(51, 186, 247, 0.2);
    }
    
    .disease-param-tag.abnormal {
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
        border-color: rgba(239, 68, 68, 0.2);
    }
    
    /* Disease Recommendations */
    .disease-recommendations {
        background: rgba(34, 197, 94, 0.05);
        border: 1px solid rgba(34, 197, 94, 0.2);
        border-radius: 8px;
        padding: 1rem;
        margin-top: 1rem;
    }
    
    .disease-recommendations h6 {
        color: #22c55e;
        margin-bottom: 0.5rem;
        font-weight: 600;
    }
    
    /* No Risk State */
    .no-disease-risk {
        text-align: center;
        padding: 3rem 2rem;
        background: linear-gradient(135deg, rgba(34, 197, 94, 0.05) 0%, rgba(16, 185, 129, 0.02) 100%);
        border: 2px dashed rgba(34, 197, 94, 0.3);
        border-radius: 16px;
    }
    
    .no-disease-risk .icon {
        font-size: 4rem;
        color: #22c55e;
        margin-bottom: 1rem;
    }
    
    /* AI Analysis Section */
    .ai-analysis-card {
        background: linear-gradient(135deg, rgba(51, 186, 247, 0.05) 0%, rgba(30, 58, 138, 0.02) 100%);
        border: 1px solid rgba(51, 186, 247, 0.2);
        border-radius: 16px;
        padding: 2rem;
        position: relative;
        overflow: hidden;
    }
    
    [data-bs-theme="dark"] .ai-analysis-card {
        background: linear-gradient(135deg, rgba(51, 186, 247, 0.1) 0%, rgba(30, 58, 138, 0.05) 100%);
        border-color: rgba(51, 186, 247, 0.3);
    }
    
    .ai-analysis-card::before {
        content: 'ü§ñ';
        position: absolute;
        top: 1rem;
        right: 1rem;
        font-size: 2rem;
        opacity: 0.3;
    }
    
    /* Recommendations */
    .recommendation-card {
        background: white;
        border-radius: 12px;
        padding: 1.25rem;
        border-left: 4px solid #22c55e;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        transition: all 0.3s ease;
    }
    
    .recommendation-card:hover {
        transform: translateX(5px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    
    [data-bs-theme="dark"] .recommendation-card {
        background: rgba(43, 48, 53, 0.8);
    }
    
    .recommendation-card.warning {
        border-left-color: #f59e0b;
    }
    
    .recommendation-card.danger {
        border-left-color: #ef4444;
    }
    
    /* Animations */
    .fade-in {
        opacity: 0;
        transform: translateY(20px);
        animation: fadeInUp 0.6s ease forwards;
    }
    
    .fade-in.delay-1 { animation-delay: 0.1s; }
    .fade-in.delay-2 { animation-delay: 0.2s; }
    .fade-in.delay-3 { animation-delay: 0.3s; }
    .fade-in.delay-4 { animation-delay: 0.4s; }
    .fade-in.delay-5 { animation-delay: 0.5s; }
    
    @keyframes fadeInUp {
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    /* Pulse animation for health score */
    .pulse {
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }
    
    /* Action Buttons */
    .action-btn {
        background: linear-gradient(135deg, #33baf7 0%, #1e3a8a 100%);
        border: none;
        border-radius: 8px;
        padding: 0.75rem 1.5rem;
        color: white;
        font-weight: 600;
        font-size: 0.9rem;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .action-btn:hover {
        background: linear-gradient(135deg, #1e3a8a 0%, #0f1419 100%);
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(51, 186, 247, 0.4);
        color: white;
    }
    
    .action-btn.secondary {
        background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
    }
    
    .action-btn.secondary:hover {
        background: linear-gradient(135deg, #4b5563 0%, #374151 100%);
        box-shadow: 0 8px 20px rgba(107, 114, 128, 0.4);
    }
    
    /* Mobile Responsive */
    @media (max-width: 768px) {
        .hero-health-section {
            padding: 2rem 0;
        }
        
        .health-score-circle {
            width: 120px;
            height: 120px;
        }
        
        .health-score-number {
            font-size: 2rem;
        }
        
        .system-health-card,
        .parameter-card,
        .disease-card {
            border-radius: 12px;
            padding: 1rem;
        }
        
        .system-icon {
            width: 40px;
            height: 40px;
            font-size: 1.25rem;
        }
        
        .system-score {
            font-size: 1.5rem;
        }
        
        .ai-analysis-card {
            padding: 1.5rem;
            border-radius: 12px;
        }
    }
    
    /* Print Styles */
    @media print {
        .hero-health-section {
            background: white !important;
            color: black !important;
        }
        
        .action-btn,
        .navbar,
        .footer {
            display: none !important;
        }
        
        .system-health-card,
        .parameter-card,
        .disease-card {
            break-inside: avoid;
            box-shadow: none !important;
            border: 1px solid #ccc !important;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero Welcome Section -->
<section class="hero-health-section">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10 text-center">
                <div class="hero-content">
                    <!-- Welcome Message -->
                    <h2 class="mb-3">ü©∫ Merhaba {{ username|title }}!</h2>
                    <p class="lead mb-4">
                        <strong>{{ analysis.file_name }}</strong> dosyanƒ±zdaki tahlil sonu√ßlarƒ±nƒ±z analiz edildi.
                        <br>A≈üaƒüƒ±da detaylƒ± raporunuzu inceleyebilirsiniz.
                    </p>
                    
                    <!-- Quick Actions -->
                    <div class="d-flex justify-content-center gap-3 flex-wrap">
                        <a href="#detailed-analysis" class="action-btn">
                            <i class="fas fa-microscope"></i>Detaylƒ± Analiz
                        </a>
                        <a href="#disease-analysis" class="action-btn secondary">
                            <i class="fas fa-stethoscope"></i>Hastalƒ±k Analizi
                        </a>
                        <button onclick="window.print()" class="action-btn secondary">
                            <i class="fas fa-print"></i>Raporu Yazdƒ±r
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<div class="container py-5">
    <!-- System Health Overview -->
    <div class="row mb-5">
        <div class="col-12">
            <h3 class="text-center mb-4 fade-in">üè• Sistem Bazlƒ± Saƒülƒ±k Durumunuz</h3>
            <p class="text-center text-muted mb-5 fade-in delay-1">
                Tahlil sonu√ßlarƒ±nƒ±z farklƒ± v√ºcut sistemleri bazƒ±nda deƒüerlendirildi
            </p>
        </div>
        
        <!-- System Health Cards -->
        <div class="col-lg-2 col-md-4 col-6 mb-4">
            <div class="system-health-card fade-in delay-1" id="cardiovascularSystem">
                <div class="system-icon">
                    <i class="fas fa-heartbeat"></i>
                </div>
                <div class="system-score">--</div>
                <div class="system-status">Kalp-Damar</div>
                <small class="text-muted">Kolesterol, kan basƒ±ncƒ±</small>
            </div>
        </div>
        
        <div class="col-lg-2 col-md-4 col-6 mb-4">
            <div class="system-health-card fade-in delay-2" id="hematologySystem">
                <div class="system-icon">
                    <i class="fas fa-tint"></i>
                </div>
                <div class="system-score">--</div>
                <div class="system-status">Kan Yapƒ±sƒ±</div>
                <small class="text-muted">Hemoglobin, alyuvar, akyuvar</small>
            </div>
        </div>
        
        <div class="col-lg-2 col-md-4 col-6 mb-4">
            <div class="system-health-card fade-in delay-3" id="liverSystem">
                <div class="system-icon">
                    <i class="fas fa-notes-medical"></i>
                </div>
                <div class="system-score">--</div>
                <div class="system-status">Karaciƒüer</div>
                <small class="text-muted">ALT, AST, bilirubin</small>
            </div>
        </div>
        
        <div class="col-lg-2 col-md-4 col-6 mb-4">
            <div class="system-health-card fade-in delay-4" id="kidneySystem">
                <div class="system-icon">
                    <i class="fas fa-filter"></i>
                </div>
                <div class="system-score">--</div>
                <div class="system-status">B√∂brek</div>
                <small class="text-muted">Kreatinin, √ºre</small>
            </div>
        </div>
        
        <div class="col-lg-2 col-md-4 col-6 mb-4">
            <div class="system-health-card fade-in delay-5" id="metabolismSystem">
                <div class="system-icon">
                    <i class="fas fa-apple-alt"></i>
                </div>
                <div class="system-score">--</div>
                <div class="system-status">Metabolizma</div>
                <small class="text-muted">Glukoz, tiroid</small>
            </div>
        </div>
        
        <div class="col-lg-2 col-md-4 col-6 mb-4">
            <div class="system-health-card fade-in delay-5" id="immuneSystem">
                <div class="system-icon">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <div class="system-score">--</div>
                <div class="system-status">Baƒüƒ±≈üƒ±klƒ±k</div>
                <small class="text-muted">CRP, sedim, lenfosit</small>
            </div>
        </div>
    </div>
    
    <!-- Detailed Parameter Analysis -->
    <div class="row mb-5" id="detailed-analysis">
        <div class="col-12">
            <h3 class="mb-4 fade-in">üî¨ Detaylƒ± Parametre Analizi</h3>
            <div class="row g-4" id="parametersContainer">
                <!-- Parameters will be dynamically loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Kategorize Edilmi≈ü Test Sonu√ßlarƒ± -->
    {% if analysis_json and analysis_json.categorized_data %}
    <div class="row mb-5">
        <div class="col-12">
            <h3 class="mb-4 fade-in">üß™ Kategorize Edilmi≈ü Test Sonu√ßlarƒ±</h3>
            
            {% for category_key, category_data in analysis_json.categorized_data.items() %}
            <div class="card mb-4 fade-in delay-{{ loop.index }}">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">{{ category_data.name }}</h5>
                    <small>{{ category_data.description }}</small>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>Test</th>
                                    <th>Sonu√ß</th>
                                    <th>Normal Aralƒ±k</th>
                                    <th>Durum</th>
                                    <th>Yorum</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for param_key, param_data in category_data.parameters.items() %}
                                <tr class="{% if not param_data.is_normal %}table-warning{% endif %}">
                                    <td>
                                        <strong>{{ param_data.name }}</strong>
                                        <br><small class="text-info">{{ param_data.what_is_it or param_data.description }}</small>
                                    </td>
                                    <td>
                                        <span class="fw-bold">{{ param_data.value }} {{ param_data.unit }}</span>
                                    </td>
                                    <td>
                                        <span class="text-muted">{{ param_data.min }} - {{ param_data.max }} {{ param_data.unit }}</span>
                                    </td>
                                    <td>
                                        <span class="badge 
                                            {% if param_data.is_normal %}bg-success
                                            {% elif param_data.status == 'y√ºksek' %}bg-danger
                                            {% else %}bg-warning{% endif %}">
                                            {{ param_data.status_emoji }} {{ param_data.status|title }}
                                        </span>
                                    </td>
                                    <td>
                                        {% if param_data.is_normal %}
                                            <small class="text-success">{{ param_data.simple_explanation or "Bu deƒüer normal aralƒ±kta, harika!" }}</small>
                                        {% else %}
                                            <small class="text-{{ 'danger' if param_data.status == 'y√ºksek' else 'warning' }}">
                                                <strong>{{ param_data.simple_explanation or ("Bu deƒüer normal √ºst√º" if param_data.status == "y√ºksek" else "Bu deƒüer normal altƒ±") }}</strong>
                                            </small>
                                            
                                            {% if param_data.possible_conditions %}
                                            <div class="mt-2">
                                                <small class="text-muted"><strong>üîç Olasƒ± Nedenler:</strong></small>
                                                <ul class="mb-0 mt-1" style="font-size: 0.75rem;">
                                                    {% for condition in param_data.possible_conditions[:3] %}
                                                    <li class="text-{{ 'danger' if param_data.status == 'y√ºksek' else 'warning' }}">{{ condition }}</li>
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                            {% endif %}
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Kategori Yorumu -->
                    {% set abnormal_params = category_data.parameters.values() | selectattr("is_normal", "false") | list %}
                    {% if abnormal_params %}
                    <div class="alert alert-warning mt-3">
                        <h6 class="alert-heading">üî∏ {{ category_data.name }} Yorumu:</h6>
                        <ul class="mb-0">
                            {% for param in abnormal_params %}
                            <li><strong>{{ param.name }}</strong> {{ param.status }}: {{ param.description }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% else %}
                    <div class="alert alert-success mt-3">
                        <i class="fas fa-check-circle me-2"></i>
                        <strong>{{ category_data.name }}</strong> kategorisindeki t√ºm deƒüerleriniz normal aralƒ±kta.
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}



    <!-- Olasƒ± Hastalƒ±klar - Disease Analysis -->
    <div class="row mb-5" id="disease-analysis">
        <div class="col-12">
            <h3 class="mb-4 fade-in">ü©∫ Olasƒ± Saƒülƒ±k Durumlarƒ±</h3>
            <div class="alert alert-info mb-4 fade-in delay-1">
                <div class="d-flex align-items-start">
                    <i class="fas fa-info-circle fa-lg me-3 mt-1"></i>
                    <div>
                        <strong>√ñnemli Not:</strong> Bu analiz sadece tahlil verilerinize dayalƒ± tahminlerdir. 
                        Kesin tanƒ± i√ßin mutlaka bir doktora danƒ±≈üƒ±n. Bu sonu√ßlar tƒ±bbi tanƒ± niteliƒüi ta≈üƒ±maz.
                    </div>
                </div>
            </div>
            <div class="row g-4" id="diseaseAnalysisContainer">
                <!-- Disease analysis will be dynamically loaded here -->
            </div>
        </div>
    </div>
    

    
    <!-- √ñneriler artƒ±k hastalƒ±k kartlarƒ±nda yer alƒ±yor -->
    
    <!-- Action Bar -->
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center p-4 bg-light rounded-3 fade-in">
                <div>
                    <h5 class="mb-1">Rapor Tarihi: {{ analysis.created_at[:10] }}</h5>
                    <small class="text-muted">{{ analysis.file_name }}</small>
                </div>
                <div class="d-flex gap-2">
                    <a href="{{ url_for('dashboard') }}" class="action-btn secondary">
                        <i class="fas fa-arrow-left"></i>Panele D√∂n
                    </a>
                    <a href="{{ url_for('analyze') }}" class="action-btn">
                        <i class="fas fa-plus"></i>Yeni Tahlil
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Hidden data for JavaScript -->
<script type="application/json" id="analysisData">
{
    "testValues": {{ test_values | tojson if test_values else '[]' }},
    "abnormalValues": {{ abnormal_values | tojson if abnormal_values else '[]' }},
    "analysisResult": {{ analysis.analysis_result | tojson if analysis.analysis_result else '""' }},
    "fileName": {{ analysis.file_name | tojson }},
    "createdAt": {{ analysis.created_at | tojson }},
    "categorizedData": {{ analysis_json.categorized_data | tojson if analysis_json and analysis_json.categorized_data else '{}' }},
    "diseaseRisks": {{ analysis_json.disease_risks | tojson if analysis_json and analysis_json.disease_risks else '[]' }},
    "extractedParameters": {{ analysis_json.extracted_parameters | tojson if analysis_json and analysis_json.extracted_parameters else '{}' }},
    "analysisJson": {{ analysis_json | tojson if analysis_json else '{}' }}
}
</script>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.js"></script>
<script>
// Premium Result Dashboard JavaScript
class PremiumResultDashboard {
    constructor() {
        this.analysisData = JSON.parse(document.getElementById('analysisData').textContent);
        

        
        this.init();
    }
    
    init() {
        this.analyzeSystemHealth();
        this.renderParameters();
        this.analyzeDiseaseRisk();
        this.generateRecommendations();
        this.startAnimations();
    }
    
    calculateHealthScore() {
        const categorizedData = this.analysisData.categorizedData || {};
        const testValues = this.analysisData.testValues || [];
        const abnormalValues = this.analysisData.abnormalValues || [];
        
        // Kategorize edilmi≈ü veriden skor hesapla
        if (Object.keys(categorizedData).length > 0) {
            let totalParams = 0;
            let normalParams = 0;
            
            Object.values(categorizedData).forEach(category => {
                Object.values(category.parameters).forEach(param => {
                    totalParams++;
                    if (param.is_normal) normalParams++;
                });
            });
            
            if (totalParams > 0) {
                const healthPercentage = Math.round((normalParams / totalParams) * 100);
                let status, message;
                
                if (healthPercentage >= 90) {
                    status = "M√ºkemmel";
                    message = "Tebrikler! Saƒülƒ±k durumunuz √ßok iyi g√∂r√ºn√ºyor. Bu durumu korumak i√ßin d√ºzenli kontrollerinizi s√ºrd√ºr√ºn.";
                } else if (healthPercentage >= 75) {
                    status = "ƒ∞yi";
                    message = "Genel saƒülƒ±k durumunuz iyi. Birka√ß parametre dikkat gerektiriyor, doktor kontrol√º √∂nerilir.";
                } else if (healthPercentage >= 60) {
                    status = "Orta";
                    message = "Bazƒ± saƒülƒ±k parametreleriniz normal dƒ±≈üƒ±. Yakƒ±n takip ve lifestyle deƒüi≈üiklikleri gerekli.";
                } else {
                    status = "Dikkat Gerekli";
                    message = "Bir√ßok parametre normal aralƒ±k dƒ±≈üƒ±nda. Acil doktor kons√ºltasyonu ≈üiddetle √∂nerilir.";
                }
                
                this.updateHealthScore(healthPercentage, status, message);
                return;
            }
        }
        
        // Fallback: Eski sistem
        if (testValues.length === 0) {
            this.updateHealthScore(75, "Orta", "Tahlil verileriniz deƒüerlendiriliyor");
            return;
        }
        
        const normalCount = testValues.length - abnormalValues.length;
        const healthPercentage = Math.round((normalCount / testValues.length) * 100);
        
        let status, message;
        if (healthPercentage >= 90) {
            status = "M√ºkemmel";
            message = "Tebrikler! Saƒülƒ±k durumunuz √ßok iyi g√∂r√ºn√ºyor. Bu durumu korumak i√ßin d√ºzenli kontrollerinizi s√ºrd√ºr√ºn.";
        } else if (healthPercentage >= 75) {
            status = "ƒ∞yi";
            message = "Genel saƒülƒ±k durumunuz iyi. Birka√ß parametre dikkat gerektiriyor, doktor kontrol√º √∂nerilir.";
        } else if (healthPercentage >= 60) {
            status = "Orta";
            message = "Bazƒ± saƒülƒ±k parametreleriniz normal dƒ±≈üƒ±. Yakƒ±n takip ve lifestyle deƒüi≈üiklikleri gerekli.";
        } else {
            status = "Dikkat Gerekli";
            message = "Bir√ßok parametre normal aralƒ±k dƒ±≈üƒ±nda. Acil doktor kons√ºltasyonu ≈üiddetle √∂nerilir.";
        }
        
        this.updateHealthScore(healthPercentage, status, message);
    }
    
    updateHealthScore(score, status, message) {
        // Update score circle
        const circle = document.getElementById('healthScoreCircle');
        const circumference = 2 * Math.PI * 70;
        const offset = circumference - (score / 100) * circumference;
        
        setTimeout(() => {
            circle.style.strokeDashoffset = offset;
            
            // Color based on score
            if (score >= 80) {
                circle.style.stroke = '#22c55e';
            } else if (score >= 60) {
                circle.style.stroke = '#f59e0b';
            } else {
                circle.style.stroke = '#ef4444';
            }
        }, 500);
        
        // Animate score number
        this.animateNumber('healthScoreNumber', 0, score, 2000);
        
        // Update status
        setTimeout(() => {
            document.getElementById('healthStatusTitle').textContent = `Saƒülƒ±k Durumunuz: ${status}`;
            document.getElementById('healthStatusMessage').textContent = message;
        }, 1000);
    }
    
    analyzeSystemHealth() {
        const categorizedData = this.analysisData.categorizedData || {};
        const abnormalValues = this.analysisData.abnormalValues || [];
        
        const systemMapping = {
            cardiovascular: {
                element: 'cardiovascularSystem',
                categories: ['lipid_profili', 'inflamasyon'],
                keywords: ['kolesterol', 'hdl', 'ldl', 'trigliserit', 'crp'],
                baseScore: 90 // Sadece fallback i√ßin
            },
            hematology: {
                element: 'hematologySystem', 
                categories: ['hemogram'],
                keywords: ['hemoglobin', 'eritrosit', 'l√∂kosit', 'trombosit', 'hematokrit', 'wbc', 'rbc', 'hgb', 'hct', 'plt'],
                baseScore: 90 // Sadece fallback i√ßin
            },
            liver: {
                element: 'liverSystem',
                categories: ['karaciger_fonksiyonlari'],
                keywords: ['alt', 'ast', 'ggt', 'bilirubin', 'albumin'],
                baseScore: 90 // Sadece fallback i√ßin
            },
            kidney: {
                element: 'kidneySystem',
                categories: ['bobrek_fonksiyonlari', 'elektrolitler'],
                keywords: ['kreatinin', '√ºre', '√ºrik asit', 'sodyum', 'potasyum', 'egfr'],
                baseScore: 90 // Sadece fallback i√ßin
            },
            metabolism: {
                element: 'metabolismSystem',
                categories: ['seker_metabolizma', 'hormonlar'],
                keywords: ['glukoz', 'hba1c', 'tsh', 't4', 't3', 'insulin', 'vitamin'],
                baseScore: 90 // Sadece fallback i√ßin
            },
            immune: {
                element: 'immuneSystem',
                categories: ['inflamasyon', 'hemogram'],
                keywords: ['crp', 'sedim', 'lenfosit', 'esr', 'lym', 'neu', 'mon'],
                baseScore: 90 // Sadece fallback i√ßin
            }
        };
        
        Object.keys(systemMapping).forEach(systemKey => {
            const system = systemMapping[systemKey];
            let totalParams = 0;
            let abnormalParams = 0;
            
            // Kategorize edilmi≈ü veriden analiz
            if (Object.keys(categorizedData).length > 0) {
                system.categories.forEach(categoryKey => {
                    if (categorizedData[categoryKey]) {
                        Object.values(categorizedData[categoryKey].parameters).forEach(param => {
                            totalParams++;
                            if (!param.is_normal) abnormalParams++;
                        });
                    }
                });
                
                if (totalParams > 0) {
                    const normalRatio = (totalParams - abnormalParams) / totalParams;
                    const score = Math.round(normalRatio * 100);
                    this.updateSystemCard(system.element, score);
                } else {
                    // Fallback: keyword bazlƒ± analiz
                    this.fallbackSystemAnalysis(system, abnormalValues);
                }
            } else {
                // Fallback: keyword bazlƒ± analiz
                this.fallbackSystemAnalysis(system, abnormalValues);
            }
        });
    }
    
    fallbackSystemAnalysis(system, abnormalValues) {
        const affectedValues = abnormalValues.filter(val => 
            system.keywords.some(keyword => 
                val.parameter_name.toLowerCase().includes(keyword)
            )
        );
        
        let score = system.baseScore;
        if (affectedValues.length > 0) {
            score = Math.max(40, score - (affectedValues.length * 15));
        }
        
        this.updateSystemCard(system.element, score);
    }
    
    updateSystemCard(elementId, score) {
        const card = document.getElementById(elementId);
        const scoreElement = card.querySelector('.system-score');
        const statusElement = card.querySelector('.system-status');
        const iconElement = card.querySelector('.system-icon');
        
        // Animate score
        this.animateNumber(scoreElement, 0, score, 1500);
        
        // Update status and styling
        let status, className;
        if (score >= 85) {
            status = 'M√ºkemmel';
            className = 'excellent';
        } else if (score >= 70) {
            status = 'ƒ∞yi';
            className = 'good';
        } else if (score >= 50) {
            status = 'Orta';
            className = 'fair';
        } else {
            status = 'Dikkat';
            className = 'poor';
        }
        
        setTimeout(() => {
            card.className = `system-health-card fade-in ${className}`;
            iconElement.className = `system-icon ${className}`;
            scoreElement.className = `system-score ${className}`;
            statusElement.className = `system-status ${className}`;
        }, 800);
    }
    
    renderParameters() {
        const categorizedData = this.analysisData.categorizedData || {};
        const testValues = this.analysisData.testValues || [];
        const container = document.getElementById('parametersContainer');
        

        
        // √ñnce kategorize edilmi≈ü veriyi kullanmayƒ± dene
        if (Object.keys(categorizedData).length > 0) {

            let html = '';
            let paramIndex = 0;
            
            Object.values(categorizedData).forEach(category => {
                Object.values(category.parameters).forEach(param => {
                    const status = this.getCategorizedParameterStatus(param);
                    const explanation = param.description;
                    
                    html += `
                        <div class="col-lg-4 col-md-6 mb-4">
                            <div class="parameter-card fade-in" style="animation-delay: ${paramIndex * 0.1}s">
                                <div class="d-flex align-items-center mb-2">
                                    <div class="parameter-status ${status.class}"></div>
                                    <h6 class="mb-0 fw-semibold">${param.name}</h6>
                                </div>
                                <div class="parameter-value">${param.value} ${param.unit}</div>
                                <div class="parameter-range">Normal: ${param.min} - ${param.max} ${param.unit}</div>
                                <div class="parameter-gauge">
                                    <div class="parameter-gauge-fill ${status.class}" style="width: ${status.width}%"></div>
                                </div>
                                <small class="text-muted">${explanation}</small>
                                ${status.message ? `<div class="small text-${status.class === 'normal' ? 'success' : 'warning'} mt-2"><strong>${status.message}</strong></div>` : ''}
                            </div>
                        </div>
                    `;
                    paramIndex++;
                });
            });
            
            if (html) {
                container.innerHTML = html;
                return;
            }
        }
        
        // Fallback: Eski sistem
        if (testValues.length === 0) {
            container.innerHTML = `
                <div class="col-12">
                    <div class="text-center p-5">
                        <i class="fas fa-flask fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">Parametre verisi bulunamadƒ±</h5>
                        <p class="text-muted">Tahlil sonu√ßlarƒ± yeniden analiz ediliyor...</p>
                    </div>
                </div>
            `;
            return;
        }
        
        let html = '';
        testValues.forEach((param, index) => {
            const status = this.getParameterStatus(param);
            const explanation = this.getParameterExplanation(param.parameter_name);
            
            html += `
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="parameter-card fade-in" style="animation-delay: ${index * 0.1}s">
                        <div class="d-flex align-items-center mb-2">
                            <div class="parameter-status ${status.class}"></div>
                            <h6 class="mb-0 fw-semibold">${param.parameter_name}</h6>
                        </div>
                        <div class="parameter-value">${param.value} ${param.unit || ''}</div>
                        <div class="parameter-range">Normal: ${param.reference_range || 'Deƒüer aralƒ±ƒüƒ± belirsiz'}</div>
                        <div class="parameter-gauge">
                            <div class="parameter-gauge-fill ${status.class}" style="width: ${status.width}%"></div>
                        </div>
                        <small class="text-muted">${explanation}</small>
                        ${status.message ? `<div class="small text-${status.class === 'normal' ? 'success' : 'warning'} mt-2"><strong>${status.message}</strong></div>` : ''}
                    </div>
                </div>
            `;
        });
        
        container.innerHTML = html;
    }
    
    getCategorizedParameterStatus(param) {
        if (param.is_normal) {
            return {
                class: 'normal',
                width: 60,
                message: null
            };
        } else if (param.status === 'y√ºksek') {
            return {
                class: 'high',
                width: 85,
                message: 'Normalden y√ºksek - Doktor kontrol√º √∂nerilir'
            };
        } else {
            return {
                class: 'low',
                width: 25,
                message: 'Normalden d√º≈ü√ºk - Takip gerekli'
            };
        }
    }
    
    getParameterStatus(param) {
        const abnormalValues = this.analysisData.abnormalValues || [];
        const isAbnormal = abnormalValues.find(abnormal => 
            abnormal.parameter_name === param.parameter_name
        );
        
        if (isAbnormal) {
            const description = isAbnormal.description?.toLowerCase() || '';
            if (description.includes('y√ºksek') || description.includes('artmƒ±≈ü')) {
                return {
                    class: 'high',
                    width: 85,
                    message: 'Normalden y√ºksek - Doktor kontrol√º √∂nerilir'
                };
            } else if (description.includes('d√º≈ü√ºk') || description.includes('azalmƒ±≈ü')) {
                return {
                    class: 'low', 
                    width: 25,
                    message: 'Normalden d√º≈ü√ºk - Takip gerekli'
                };
            }
        }
        
        return {
            class: 'normal',
            width: 60,
            message: null
        };
    }
    
    getParameterExplanation(paramName) {
        // A√ßƒ±klamalar artƒ±k backend'den geliyor (param.description)
        // Bu fonksiyon sadece fallback i√ßin kullanƒ±lƒ±yor
        return 'Bu parametre saƒülƒ±k durumunuzun √∂nemli bir g√∂stergesidir';
    }
    
    analyzeDiseaseRisk() {
        const diseaseRisks = this.analysisData.diseaseRisks || [];
        const abnormalValues = this.analysisData.abnormalValues || [];
        const container = document.getElementById('diseaseAnalysisContainer');
        let html = '';
        

        
        // √ñnce AI hastalƒ±k tahminlerini kontrol et
        if (this.analysisData.analysisJson && this.analysisData.analysisJson.health_conditions && this.analysisData.analysisJson.health_conditions.length > 0) {
            const aiConditions = this.analysisData.analysisJson.health_conditions;

            
            aiConditions.forEach((condition, index) => {
                const diseaseIcon = this.getDiseaseIcon(condition.name);
                
                html += `
                    <div class="col-lg-6 mb-4">
                        <div class="disease-card ai-prediction fade-in" style="animation-delay: ${index * 0.2}s">
                            <div class="d-flex align-items-start mb-3">
                                <div class="disease-icon ai-prediction">
                                    ${diseaseIcon}
                                </div>
                                <div class="flex-grow-1">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <h5 class="mb-1">${condition.name}</h5>
                                        <div class="ai-badge">
                                            <i class="fas fa-robot"></i> AI Tahmin
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <p class="mb-3 text-muted">${condition.description}</p>
                            
                            ${condition.related_values ? `
                                <div class="disease-params">
                                    <small class="text-muted fw-semibold d-block mb-2">ƒ∞lgili Test Parametreleri:</small>
                                    ${condition.related_values.split(',').map(param => 
                                        `<span class="disease-param-tag">${param.trim()}</span>`
                                    ).join('')}
                                </div>
                            ` : ''}
                            
                            <div class="ai-recommendation">
                                <h6><i class="fas fa-stethoscope me-2"></i>AI √ñnerisi</h6>
                                <p class="mb-0 small">Bu durum hakkƒ±nda bir saƒülƒ±k uzmanƒ±na danƒ±≈ümanƒ±z √∂nerilir.</p>
                            </div>
                        </div>
                    </div>
                `;
            });
        }
        
        // Sonra backend'den gelen risk verilerini kullan
        if (diseaseRisks.length > 0) {

            diseaseRisks.forEach((risk, index) => {
                const riskClass = this.getRiskClass(risk.risk_percentage);
                const diseaseIcon = this.getDiseaseIcon(risk.name);
                const recommendations = this.getDiseaseRecommendations(risk.name, risk.risk_percentage);
                
                html += `
                    <div class="col-lg-6 mb-4">
                        <div class="disease-card ${riskClass} fade-in" style="animation-delay: ${index * 0.2}s">
                            <div class="d-flex align-items-start mb-3">
                                <div class="disease-icon ${riskClass}">
                                    ${diseaseIcon}
                                </div>
                                <div class="flex-grow-1">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <h5 class="mb-1">${risk.name}</h5>
                                        <div class="disease-probability ${riskClass}">%${risk.risk_percentage}</div>
                                    </div>
                                    <span class="badge bg-${riskClass === 'high-risk' ? 'danger' : riskClass === 'medium-risk' ? 'warning' : 'info'} mb-2">
                                        ${risk.severity_emoji} ${risk.severity}
                                    </span>
                                </div>
                            </div>
                            
                            <p class="mb-3 text-muted">${risk.description}</p>
                            
                            <div class="disease-params">
                                <small class="text-muted fw-semibold d-block mb-2">ƒ∞lgili Test Parametreleri:</small>
                                ${risk.related_parameters.map(param => {
                                    const isAbnormal = this.isParameterAbnormal(param);
                                    return `<span class="disease-param-tag ${isAbnormal ? 'abnormal' : ''}">${param}</span>`;
                                }).join('')}
                            </div>
                            
                            <div class="disease-recommendations">
                                <h6><i class="fas fa-lightbulb me-2"></i>√ñneriler</h6>
                                <ul class="mb-0">
                                    ${recommendations.map(rec => `<li class="small">${rec}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
            });
        }
        
        // Hem AI hem backend verisi varsa HTML'i g√∂ster
        if (html) {
            container.innerHTML = html;
            return;
        }
        
        // Fallback: Hi√ß veri yoksa "risk yok" g√∂ster
        container.innerHTML = `
            <div class="col-12">
                <div class="no-disease-risk">
                    <div class="icon">
                        <i class="fas fa-heart"></i>
                    </div>
                    <h4 class="text-success mb-3">üéâ Tebrikler! Herhangi Bir Risk Tespit Edilmedi</h4>
                    <p class="text-muted mb-4 lead">
                        Tahlil sonu√ßlarƒ±nƒ±z normal aralƒ±klarda g√∂r√ºn√ºyor. Bu harika bir durum!
                    </p>
                    
                    <div class="row g-3 mb-4">
                        <div class="col-md-4">
                            <div class="text-center">
                                <i class="fas fa-running fa-2x text-success mb-2"></i>
                                <h6>D√ºzenli Egzersiz</h6>
                                <small class="text-muted">Haftada 150 dakika</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center">
                                <i class="fas fa-apple-alt fa-2x text-success mb-2"></i>
                                <h6>Dengeli Beslenme</h6>
                                <small class="text-muted">Sebze ve meyve aƒüƒ±rlƒ±klƒ±</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center">
                                <i class="fas fa-calendar-check fa-2x text-success mb-2"></i>
                                <h6>D√ºzenli Kontrol</h6>
                                <small class="text-muted">Yƒ±lda 1-2 kez</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-success border-0 mb-0">
                        <div class="d-flex align-items-start">
                            <i class="fas fa-lightbulb fa-lg me-3 mt-1"></i>
                            <div>
                                <strong>Saƒülƒ±klƒ± kalmak i√ßin:</strong> Mevcut ya≈üam tarzƒ±nƒ±zƒ± s√ºrd√ºr√ºn, 
                                yƒ±lda bir kez genel check-up yaptƒ±rƒ±n ve v√ºcudunuzdaki deƒüi≈üiklikleri takip edin.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        return;
    }
    
    getRiskClass(percentage) {
        if (percentage >= 70) return 'high-risk';
        if (percentage >= 40) return 'medium-risk';
        if (percentage >= 15) return 'low-risk';
        return 'no-risk';
    }
    
    getDiseaseIcon(diseaseName) {
        const iconMap = {
            'Anemi': '<i class="fas fa-tint"></i>',
            'Tip 2 Diyabet': '<i class="fas fa-candy-cane"></i>',
            'Prediyabet': '<i class="fas fa-exclamation-triangle"></i>',
            'Hipotiroidi': '<i class="fas fa-thermometer-three-quarters"></i>',
            'Hipertiroidi': '<i class="fas fa-thermometer-full"></i>',
            'Karaciƒüer': '<i class="fas fa-notes-medical"></i>',
            'B√∂brek': '<i class="fas fa-filter"></i>',
            'Kardiyovask√ºler': '<i class="fas fa-heartbeat"></i>',
            'Enfeksiyon': '<i class="fas fa-virus"></i>',
            'Demir Eksikliƒüi': '<i class="fas fa-magnet"></i>',
            'Pankreatit': '<i class="fas fa-stomach"></i>',
            'Vitamin D': '<i class="fas fa-sun"></i>',
            'Vitamin B12': '<i class="fas fa-pills"></i>'
        };
        
        // Hastalƒ±k adƒ±ndan anahtar kelime bul
        for (const [key, icon] of Object.entries(iconMap)) {
            if (diseaseName.toLowerCase().includes(key.toLowerCase())) {
                return icon;
            }
        }
        
        return '<i class="fas fa-stethoscope"></i>'; // Varsayƒ±lan ikon
    }
    
    getDiseaseRecommendations(diseaseName, riskPercentage) {
        const recommendations = {
            'Anemi': [
                'Demir bakƒ±mƒ±ndan zengin gƒ±dalar t√ºketin (kƒ±rmƒ±zƒ± et, ƒ±spanak, mercimek)',
                'Vitamin C ile demir emilimini artƒ±rƒ±n (portakal, √ßilek)',
                'Hematoloji uzmanƒ±na danƒ±≈üƒ±n',
                'B12 ve folik asit seviyelerinizi kontrol ettirin'
            ],
            'Tip 2 Diyabet': [
                '≈ûeker ve i≈ülenmi≈ü gƒ±da t√ºketimini azaltƒ±n',
                'D√ºzenli egzersiz yapƒ±n (haftada en az 150 dakika)',
                'Endokrinoloji uzmanƒ±na ba≈üvurun',
                'Kilo kontrol√º ve saƒülƒ±klƒ± beslenme planƒ± olu≈üturun'
            ],
            'Prediyabet': [
                'Ya≈üam tarzƒ± deƒüi≈üiklikleri ile diyabeti √∂nleyebilirsiniz',
                'Kompleks karbonhidrat tercih edin',
                'D√ºzenli y√ºr√ºy√º≈ü yapƒ±n',
                '6 ayda bir kontrol yaptƒ±rƒ±n'
            ],
            'Hipotiroidi': [
                'Endokrinoloji uzmanƒ±na ba≈üvurun',
                'ƒ∞yot a√ßƒ±sƒ±ndan zengin besinler t√ºketin',
                'D√ºzenli ila√ß kullanƒ±mƒ±na dikkat edin',
                'TSH seviyenizi d√ºzenli takip ettirin'
            ],
            'Hipertiroidi': [
                'Endokrinoloji uzmanƒ±na acil ba≈üvurun',
                'Kafein ve uyarƒ±cƒ± i√ßeceklerden ka√ßƒ±nƒ±n',
                'Stres y√∂netimi teknikleri uygulayƒ±n',
                'Kalp ritmini d√ºzenli kontrol ettirin'
            ],
            'Karaciƒüer': [
                'Alkol t√ºketimini bƒ±rakƒ±n veya azaltƒ±n',
                'Gastroenteroloji uzmanƒ±na ba≈üvurun',
                'Yaƒülƒ± gƒ±dalardan ka√ßƒ±nƒ±n',
                'Hepatit B/C taramasƒ± yaptƒ±rƒ±n'
            ],
            'B√∂brek': [
                'Nefroloji uzmanƒ±na ba≈üvurun',
                'Su t√ºketimini artƒ±rƒ±n',
                'Tuz alƒ±mƒ±nƒ± azaltƒ±n',
                'ƒ∞drar tetkiki yaptƒ±rƒ±n'
            ],
            'Kardiyovask√ºler': [
                'Kardiyoloji uzmanƒ±na ba≈üvurun',
                'Kolesterol diyeti uygulayƒ±n',
                'D√ºzenli egzersiz yapƒ±n',
                'Sigara i√ßiyorsanƒ±z bƒ±rakƒ±n'
            ],
            'Enfeksiyon': [
                'ƒ∞√ß hastalƒ±klarƒ± uzmanƒ±na ba≈üvurun',
                'Dinlenin ve bol sƒ±vƒ± t√ºketin',
                'Antibiyotik ihtiyacƒ± olup olmadƒ±ƒüƒ±nƒ± ara≈ütƒ±rƒ±n',
                'Ate≈ü ve semptomlarƒ± takip edin'
            ],
            'Pankreatit': [
                'Gastroenteroloji uzmanƒ±na acil ba≈üvurun',
                'Alkol ve yaƒülƒ± gƒ±dalardan tamamen ka√ßƒ±nƒ±n',
                'Pankreas enzim takviyeleri gerekebilir',
                'Kan ≈üekeri seviyenizi takip edin'
            ],
            'Vitamin D': [
                'G√ºne≈üte daha fazla vakit ge√ßirin',
                'D vitamini takviyesi alƒ±n',
                'Balƒ±k, yumurta ve s√ºt √ºr√ºnleri t√ºketin',
                'Kemik yoƒüunluƒüu kontrol√º yaptƒ±rƒ±n'
            ],
            'Vitamin B12': [
                'B12 takviyesi alƒ±n',
                'Et, balƒ±k ve s√ºt √ºr√ºnleri t√ºketin',
                'Hematoloji uzmanƒ±na danƒ±≈üƒ±n',
                'Sinir sistemi muayenesi yaptƒ±rƒ±n'
            ]
        };
        
        // Hastalƒ±k adƒ±ndan uygun √∂nerileri bul
        for (const [key, recs] of Object.entries(recommendations)) {
            if (diseaseName.toLowerCase().includes(key.toLowerCase())) {
                // Risk y√ºzdesine g√∂re √∂neri sayƒ±sƒ±nƒ± ayarla
                const maxRecs = riskPercentage >= 70 ? 4 : riskPercentage >= 40 ? 3 : 2;
                return recs.slice(0, maxRecs);
            }
        }
        
        // Varsayƒ±lan √∂neriler
        return [
            'Doktorunuza danƒ±≈üƒ±n',
            'Saƒülƒ±klƒ± ya≈üam tarzƒ± benimseyin',
            'D√ºzenli kontrollerinizi ihmal etmeyin'
        ];
    }
    
    isParameterAbnormal(paramName) {
        const categorizedData = this.analysisData.categorizedData || {};
        
        // Kategorize edilmi≈ü verilerde parametreyi ara
        for (const category of Object.values(categorizedData)) {
            for (const [key, param] of Object.entries(category.parameters)) {
                if (key === paramName || param.name.includes(paramName)) {
                    return !param.is_normal;
                }
            }
        }
        
        // Abnormal values listesinde ara (fallback)
        const abnormalValues = this.analysisData.abnormalValues || [];
        return abnormalValues.some(abnormal => 
            abnormal.parameter_name.includes(paramName) || paramName.includes(abnormal.parameter_name)
        );
    }
    
    // generateDiseaseAnalysis fonksiyonu kaldƒ±rƒ±ldƒ± - artƒ±k backend'den gelen ger√ßek veri kullanƒ±lƒ±yor
    
    generateRecommendations() {
        // √ñneriler artƒ±k hastalƒ±k kartlarƒ±nda g√∂steriliyor
        // Bu fonksiyon artƒ±k kullanƒ±lmƒ±yor
        const container = document.getElementById('recommendationsContainer');
        if (container) {
            container.innerHTML = '<div class="col-12"><p class="text-muted text-center">√ñneriler hastalƒ±k kartlarƒ±nda yer almaktadƒ±r.</p></div>';
        }
    }
    
    startAnimations() {
        // Fade in animations
        setTimeout(() => {
            const elements = document.querySelectorAll('.fade-in');
            elements.forEach((element, index) => {
                setTimeout(() => {
                    element.style.opacity = '1';
                    element.style.transform = 'translateY(0)';
                }, index * 100);
            });
        }, 200);
        
        // Gauge animations
        setTimeout(() => {
            document.querySelectorAll('.parameter-gauge-fill').forEach(gauge => {
                const width = gauge.style.width;
                gauge.style.width = '0%';
                setTimeout(() => {
                    gauge.style.width = width;
                }, 100);
            });
        }, 1000);
    }
    
    animateNumber(element, start, end, duration) {
        const el = typeof element === 'string' ? document.getElementById(element) : element;
        const startTime = performance.now();
        
        const animate = (currentTime) => {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);
            
            const current = Math.round(start + (end - start) * progress);
            el.textContent = current;
            
            if (progress < 1) {
                requestAnimationFrame(animate);
            }
        };
        
        requestAnimationFrame(animate);
    }
}

// Initialize dashboard when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    new PremiumResultDashboard();
    
    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        });
    });
});
</script>
{% endblock %}